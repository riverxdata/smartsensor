<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Image Marker</title>
		<script>
			let startX, startY;
			function setImage(event) {
				let file = event.target.files[0];
				let formData = new FormData();
				formData.append("file", file);
				fetch("/upload", { method: "POST", body: formData })
					.then((response) => response.json())
					.then((data) => {
						document.getElementById("image").src = data.image_path;
					});
			}

			function markRegion(event) {
				let img = event.target;
				let rect = img.getBoundingClientRect();
				let x = event.clientX - rect.left;
				let y = event.clientY - rect.top;
				if (!startX || !startY) {
					startX = x;
					startY = y;
				} else {
					let width = x - startX;
					let height = y - startY;
					fetch("/mark", {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({
							x: startX,
							y: startY,
							w: width,
							h: height,
						}),
					})
						.then((response) => response.json())
						.then((data) => {
							document.getElementById("image").src =
								data.image_path;
						});
					startX = startY = null;
				}
			}
		</script>
	</head>
	<body>
		<input type="file" accept="image/*" onchange="setImage(event)" />
		<br />
		<img
			id="image"
			src=""
			alt="Uploaded Image"
			onclick="markRegion(event)"
			style="max-width: 100%; cursor: crosshair"
		/>
	</body>
</html>
